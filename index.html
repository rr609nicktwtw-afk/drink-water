<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è£œæ°´å°ç²¾éˆ ğŸ’§</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f8ff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
        }
        .container {
            background-color: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-sizing: border-box;
            position: relative;
        }
        h1 { color: #5dade2; font-size: 1.8rem; margin-top: 0; }
        .stats { margin: 20px 0; }
        .total-amount { font-size: 2.5rem; font-weight: bold; color: #2e86c1; }
        .progress-container {
            background-color: #e5e8e8;
            border-radius: 10px;
            height: 20px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
        }
        .progress-bar {
            background-color: #5dade2;
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }
        .progress-text {
            position: absolute;
            width: 100%;
            text-align: center;
            top: 0;
            font-size: 0.8rem;
            line-height: 20px;
            color: #fff;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        input {
            flex: 1;
            padding: 10px;
            border: 2px solid #d4e6f1;
            border-radius: 10px;
            outline: none;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #5dade2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
            font-weight: bold;
            font-size: 1rem;
            white-space: nowrap;
        }
        button:hover { background-color: #3498db; }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .btn-reset { background-color: #ec7063; font-size: 0.9rem; flex: 1; }
        .btn-reset:hover { background-color: #e74c3c; }
        .btn-stats { background-color: #f39c12; font-size: 0.9rem; flex: 1; }
        .btn-stats:hover { background-color: #e67e22; }

        .history {
            text-align: left;
            max-height: 150px;
            overflow-y: auto;
            border-top: 1px solid #eee;
            padding-top: 15px;
            margin-top: 10px;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 0.95rem;
            color: #555;
            border-bottom: 1px dashed #f0f0f0;
        }

        /* è‡ªè¨‚å½ˆå‡ºè¦–çª—æ¨£å¼ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(2px);
        }
        .modal {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            animation: popIn 0.3s ease-out;
            max-height: 80vh;
            overflow-y: auto;
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .modal h2 { margin-top: 0; color: #2e86c1; font-size: 1.4rem; }
        .modal p { margin-bottom: 20px; color: #333; font-weight: bold; }
        .modal-buttons { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .btn-cancel { background-color: #bdc3c7; }
        .btn-cancel:hover { background-color: #95a5a6; }

        /* çµ±è¨ˆåœ–è¡¨æ¨£å¼ */
        .month-total { font-size: 1.5rem; color: #e67e22; font-weight: bold; margin: 10px 0; }
        .chart-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 150px;
            margin: 20px 0;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
            position: relative;
        }
        .bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 12%;
            height: 100%;
            justify-content: flex-end;
        }
        .bar {
            background-color: #85c1e9;
            width: 100%;
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
            position: relative;
        }
        .bar-label {
            font-size: 0.7rem;
            color: #7f8c8d;
            margin-top: 5px;
            position: absolute;
            bottom: -20px;
        }
        .bar-value {
            font-size: 0.65rem;
            color: #2980b9;
            margin-bottom: 2px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ’§ è£œæ°´å°ç²¾éˆ</h1>
    <div class="stats">
        <p style="margin:0; color:#7f8c8d; font-size: 0.9rem;">ä»Šæ—¥å·²é£²æ°´</p>
        <div class="total-amount"><span id="total">0</span> <small style="font-size: 1rem;">ml</small></div>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
            <div class="progress-text">ç›®æ¨™ 3000 ml</div>
        </div>
        <p id="message" style="font-size: 0.95rem; color: #5499c7; font-weight: bold;">åŠ æ²¹ï¼å¤šå–æ°´çš®è†šæœƒè®Šå¥½å–”ï½</p>
    </div>

    <div class="input-group">
        <input type="number" id="waterInput" placeholder="è¼¸å…¥ cc æ•¸..." min="1">
        <button onclick="addWater()">å–æ‰å®ƒï¼</button>
    </div>

    <div class="history">
        <strong style="color: #5dade2;">ğŸ“ ä»Šæ—¥é£²æ°´å°æœ¬æœ¬ï¼š</strong>
        <div id="historyList"></div>
    </div>
    
    <div class="btn-group">
        <button class="btn-reset" onclick="requestReset()">é‡ç½®ä»Šæ—¥</button>
        <button class="btn-stats" onclick="showStats()">ğŸ“Š çœ‹çµ±è¨ˆ</button>
    </div>
</div>

<!-- è‡ªè¨‚æé†’è¦–çª— -->
<div class="modal-overlay" id="alertModal">
    <div class="modal" style="max-width: 250px;">
        <p id="alertMessage">æç¤ºè¨Šæ¯</p>
        <button onclick="closeModal('alertModal')">çŸ¥é“æƒ¹ï¼</button>
    </div>
</div>

<!-- è‡ªè¨‚ç¢ºèªè¦–çª— -->
<div class="modal-overlay" id="confirmModal">
    <div class="modal" style="max-width: 280px;">
        <p>ç¢ºå®šè¦æ¸…é™¤ã€Œä»Šå¤©ã€çš„ç´€éŒ„å—ï¼Ÿ(>_<)</p>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeModal('confirmModal')">å–æ¶ˆ</button>
            <button class="btn-reset" style="margin-top:0; width:auto;" onclick="executeReset()">ç¢ºå®šæ¸…é™¤</button>
        </div>
    </div>
</div>

<!-- çµ±è¨ˆè³‡æ–™è¦–çª— -->
<div class="modal-overlay" id="statsModal">
    <div class="modal">
        <h2>ğŸ“Š ä½ çš„è£œæ°´æˆç¸¾å–®</h2>
        <p style="margin-bottom: 5px; color: #7f8c8d; font-size: 0.9rem;">æœ¬æœˆç¸½é£²æ°´é‡</p>
        <div class="month-total"><span id="monthTotalAmount">0</span> <small style="font-size: 1rem;">ml</small></div>
        
        <p style="margin-top: 20px; margin-bottom: 10px; color: #7f8c8d; font-size: 0.9rem;">è¿‘ä¸ƒå¤©æ—¥çµ±è¨ˆ</p>
        <div class="chart-container" id="barChart">
            <!-- é•·æ¢åœ–æœƒç”± JS ç”Ÿæˆ -->
        </div>

        <button class="btn-cancel" style="width: 100%; margin-top: 10px;" onclick="closeModal('statsModal')">é—œé–‰</button>
    </div>
</div>

<script>
    const goal = 3000; // ç›®æ¨™æ”¹ç‚º 3000ml å›‰ï¼
    
    // å¾ç€è¦½å™¨å„²å­˜ç©ºé–“è®€å–è³‡æ–™ï¼Œå¦‚æœæ²’æœ‰å°±çµ¦ä¸€å€‹ç©ºç‰©ä»¶
    // è³‡æ–™æ ¼å¼ï¼š { "2023-10-25": [{time: "10:00", amount: 200}, ...] }
    let appData = JSON.parse(localStorage.getItem('waterData')) || {};

    // å–å¾—ä»Šå¤©çš„æ—¥æœŸå­—ä¸² (YYYY-MM-DD)
    function getTodayStr() {
        const d = new Date();
        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
    }

    // å–å¾—é€™å€‹æœˆçš„å­—ä¸² (YYYY-MM)
    function getMonthStr() {
        const d = new Date();
        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
    }

    // åˆå§‹åŒ–ç•«é¢
    function init() {
        updateUI();
    }

    // æ–°å¢å–æ°´ç´€éŒ„
    function addWater() {
        const input = document.getElementById('waterInput');
        const amount = parseInt(input.value);

        if (isNaN(amount) || amount <= 0) {
            showAlert("è«‹è¼¸å…¥æ­£ç¢ºçš„æ°´é‡å”·ï¼(,,ãƒ»Ï‰ãƒ»,,)");
            return;
        }

        const today = getTodayStr();
        if (!appData[today]) {
            appData[today] = [];
        }

        const now = new Date();
        const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
        
        // å„²å­˜é€²è³‡æ–™åº«
        appData[today].push({ time: timeStr, amount: amount });
        localStorage.setItem('waterData', JSON.stringify(appData));

        updateUI();
        input.value = '';
    }

    // æ›´æ–°ä¸»ç•«é¢
    function updateUI() {
        const today = getTodayStr();
        const todayRecords = appData[today] || [];
        
        // è¨ˆç®—ä»Šæ—¥ç¸½å’Œ
        let todayTotal = todayRecords.reduce((sum, record) => sum + record.amount, 0);

        document.getElementById('total').innerText = todayTotal;
        
        // æ›´æ–°é€²åº¦æ¢
        const percent = Math.min((todayTotal / goal) * 100, 100);
        document.getElementById('progressBar').style.width = percent + '%';

        // é‡æ–°æ¸²æŸ“æ­·å²ç´€éŒ„ (åè½‰é™£åˆ—è®“æœ€æ–°çš„ä¸€ç­†åœ¨æœ€ä¸Šé¢)
        const historyList = document.getElementById('historyList');
        historyList.innerHTML = '';
        
        [...todayRecords].reverse().forEach(record => {
            const item = document.createElement('div');
            item.className = 'history-item';
            item.innerHTML = `<span>ğŸ•’ ${record.time}</span> <span style="color: #2e86c1; font-weight: bold;">+${record.amount} ml</span>`;
            historyList.appendChild(item);
        });

        // æª¢æŸ¥æ˜¯å¦é”æˆç›®æ¨™
        const messageEl = document.getElementById('message');
        if (todayTotal >= goal) {
            messageEl.innerText = "ğŸ‰ å¤ªæ£’äº†ï¼3000ml é”æˆï¼âœ¨";
            messageEl.style.color = "#27ae60";
        } else {
            messageEl.innerText = "åŠ æ²¹ï¼å¤šå–æ°´çš®è†šæœƒè®Šå¥½å–”ï½";
            messageEl.style.color = "#5499c7";
        }
    }

    // æ‰“é–‹çµ±è¨ˆé¢æ¿
    function showStats() {
        const monthStr = getMonthStr();
        let monthTotal = 0;
        
        // è¨ˆç®—æœ¬æœˆç¸½å’Œ
        for (const [date, records] of Object.entries(appData)) {
            if (date.startsWith(monthStr)) {
                monthTotal += records.reduce((sum, r) => sum + r.amount, 0);
            }
        }
        document.getElementById('monthTotalAmount').innerText = monthTotal;

        // ç”Ÿæˆè¿‘ä¸ƒå¤©æ—¥çµ±è¨ˆ
        const chartContainer = document.getElementById('barChart');
        chartContainer.innerHTML = ''; // æ¸…ç©ºèˆŠåœ–è¡¨
        
        // å–å¾—éå»ä¸ƒå¤©çš„æ—¥æœŸ
        const last7Days = [];
        for (let i = 6; i >= 0; i--) {
            const d = new Date();
            d.setDate(d.getDate() - i);
            const dateStr = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
            const displayDate = `${d.getMonth() + 1}/${d.getDate()}`;
            
            const dayRecords = appData[dateStr] || [];
            const dayTotal = dayRecords.reduce((sum, r) => sum + r.amount, 0);
            
            last7Days.push({ date: displayDate, total: dayTotal });
        }

        // æ‰¾å‡ºé€™ä¸ƒå¤©çš„æœ€å¤§å€¼ä½œç‚ºé•·æ¢åœ–çš„ 100% åŸºæº– (è‡³å°‘è¦ä»¥ goal ç‚ºåŸºæº–æ‰å¥½çœ‹)
        const maxAmount = Math.max(goal, ...last7Days.map(d => d.total));

        // ç¹ªè£½é•·æ¢åœ–
        last7Days.forEach(day => {
            const heightPercent = (day.total / maxAmount) * 100;
            const barWrapper = document.createElement('div');
            barWrapper.className = 'bar-wrapper';
            
            let barColor = '#85c1e9';
            if(day.total >= goal) barColor = '#58d68d'; // é”æ¨™è®Šç¶ è‰²
            if(day.total === 0) barColor = '#eaecee';

            barWrapper.innerHTML = `
                <div class="bar-value">${day.total > 0 ? day.total : ''}</div>
                <div class="bar" style="height: ${heightPercent}%; background-color: ${barColor};"></div>
                <div class="bar-label">${day.date}</div>
            `;
            chartContainer.appendChild(barWrapper);
        });

        document.getElementById('statsModal').style.display = 'flex';
    }

    // å‘¼å«ç¢ºèªè¦–çª—
    function requestReset() {
        document.getElementById('confirmModal').style.display = 'flex';
    }

    // ç¢ºå®šé‡ç½®ã€Œä»Šæ—¥ã€è³‡æ–™
    function executeReset() {
        const today = getTodayStr();
        appData[today] = []; // æ¸…ç©ºä»Šå¤©çš„é™£åˆ—
        localStorage.setItem('waterData', JSON.stringify(appData)); // å­˜å›è³‡æ–™åº«
        
        updateUI(); // é‡æ–°æ•´ç†ç•«é¢
        closeModal('confirmModal');
    }

    // é¡¯ç¤ºè‡ªè¨‚æé†’è¦–çª—
    function showAlert(msg) {
        document.getElementById('alertMessage').innerText = msg;
        document.getElementById('alertModal').style.display = 'flex';
    }

    // é—œé–‰è¦–çª—
    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
    }

    // å•Ÿå‹•ç¨‹å¼
    init();
</script>

</body>
</html>